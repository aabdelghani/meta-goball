# =============================================================================
# GoBall Deployment Configuration
# =============================================================================
# This file lists ALL parameters that must be reviewed/changed when deploying
# the GoBall system to a new machine. Each parameter includes:
#   - Current value
#   - File location where it must be changed
#   - Description
#
# IMPORTANT: Parameters marked [REBUILD] require a full Yocto rebuild + reflash.
# Parameters marked [RUNTIME] can be changed on the running device via SSH.
# Parameters marked [CODE] require a code push + recipe clean + rebuild.
# =============================================================================

# =============================================================================
# 1. NETWORK CONFIGURATION
# =============================================================================

# --- WiFi ---
# File: recipes-config/goball-config/files/Banhof.nmconnection  [REBUILD]
WIFI_SSID = "Banhof"
WIFI_PASSWORD = "Dafuq123@4"
WIFI_SECURITY = "wpa-psk"           # wpa-psk | wpa-eap | none
WIFI_AUTOCONNECT = true
WIFI_PRIORITY = 100                 # Higher = preferred over other connections

# --- Ethernet ---
# File: recipes-config/goball-config/files/Ethernet.nmconnection  [REBUILD]
ETH_METHOD = "manual"               # manual (static) | auto (DHCP)
ETH_STATIC_IP = "10.0.0.2/24"
ETH_GATEWAY = ""                    # Leave empty for direct PC connection
ETH_DNS = ""                        # Leave empty for direct PC connection
ETH_PRIORITY = 200                  # Higher than WiFi = preferred when plugged in

# --- Hostname ---
# File: Currently uses default "raspberrypi5"  [RUNTIME]
# Change with: hostnamectl set-hostname <name>
HOSTNAME = "raspberrypi5"

# =============================================================================
# 2. DISPLAY CONFIGURATION
# =============================================================================

# --- HDMI Port ---
# The physical HDMI port the monitor is connected to.
# File: build/conf/local.conf (CMDLINE video=), weston.ini  [REBUILD]
HDMI_OUTPUT = "HDMI-A-2"            # HDMI-A-1 | HDMI-A-2

# --- Resolution ---
# Must be consistent across ALL of these files:
#   build/conf/local.conf          -> RPI_EXTRA_CONFIG hdmi_cvt, CMDLINE video=
#   weston.ini                     -> [output] mode=
#   GoBall source main.c           -> hal_init(width, height)
# Files: local.conf, weston.ini [REBUILD] + main.c [CODE]
DISPLAY_WIDTH = 2560
DISPLAY_HEIGHT = 720
DISPLAY_REFRESH = 60                # Hz

# --- Fullscreen ---
# File: GoBall source lv_conf.h -> LV_SDL_FULLSCREEN  [CODE]
FULLSCREEN = 0                      # 0 = windowed, 1 = fullscreen

# =============================================================================
# 3. GPIO PIN MAPPING (Ball Sensors)
# =============================================================================
# File: GoBall source modules/logic/gpio_event.h  [CODE]

PIN_THREE_POINTS_HOLE = 17          # GPIO pin for 3-point sensor
PIN_FOUR_POINTS_HOLE = 26           # GPIO pin for 4-point sensor
PIN_FIVE_POINTS_HOLE = 27           # GPIO pin for 5-point sensor
PIN_ZERO_POINTS_HOLE = 24           # GPIO pin for 0-point sensor
DEBOUNCE_TIME_MS = 3000             # Sensor debounce delay (ms)

# =============================================================================
# 4. LED STRIP CONFIGURATION
# =============================================================================
# File: GoBall source modules/led_logic/led_logic_event.h  [CODE]
# Runtime override: /usr/bin/goball <gpio1> <gpio2> <brightness>

LED_ENABLED = false                 # true | false (false if no strips connected)
LED_PIXELS = 144                    # Total LEDs per strip
LED_GPIO1 = 3                       # First strip data pin
LED_GPIO2 = 2                       # Second strip data pin
LED_BRIGHTNESS = 10                 # 0-255
LED_NUM_TRAINS = 5                  # Animation train count
LED_TRAIN_LENGTH = 10               # Pixels per train

# =============================================================================
# 5. AUDIO CONFIGURATION
# =============================================================================
# File: goball.service [REBUILD], GoBall source sound_logic_event.h [CODE]

AUDIO_DRIVER = "pulseaudio"         # pulseaudio | alsa
SOUND_DIR = "/opt/goball/sounds/"   # Absolute path on target device
PULSE_SERVER = "unix:/run/pulse/native"

# =============================================================================
# 6. SSH / SECURITY
# =============================================================================
# File: recipes-config/goball-config/files/authorized_keys  [REBUILD]
# File: build/conf/local.conf (EXTRA_IMAGE_FEATURES)  [REBUILD]

SSH_ROOT_LOGIN = true               # Enabled via debug-tweaks + dropbear bbappend
SSH_AUTH_METHOD = "key+password"     # key+password (dev) | key-only (production)
# To change authorized keys, replace the public key in:
#   recipes-config/goball-config/files/authorized_keys

# =============================================================================
# 7. BOOT EXPERIENCE
# =============================================================================
# File: build/conf/local.conf, EEPROM config  [REBUILD] + [RUNTIME]

BOOT_SPLASH = true                  # psplash loading screen during boot
BOOT_SILENT = true                  # No kernel messages on screen
EEPROM_DISPLAY_DIAGNOSTIC = 0       # 0 = hide EEPROM bootloader screen [RUNTIME]
#   To change EEPROM on running device:
#   rpi-eeprom-config > /tmp/boot.conf
#   echo "DISPLAY_DIAGNOSTIC=0" >> /tmp/boot.conf
#   rpi-eeprom-config --apply /tmp/boot.conf
#   reboot

# =============================================================================
# 8. BUILD HOST SETTINGS
# =============================================================================
# File: build/conf/local.conf  [REBUILD]

MACHINE = "raspberrypi5"            # Target SoC/board
BB_NUMBER_THREADS = 28              # Bitbake parallel tasks (= CPU cores)
PARALLEL_MAKE = 32                  # make -j value (= CPU cores + 4)
IMAGE_ROOTFS_EXTRA_SPACE = 1048576  # Extra rootfs space in KB (1GB)
CMAKE_BUILD_TYPE = "Debug"          # Debug | Release (Release = WARN-only logging)

# =============================================================================
# 9. APPLICATION TUNING
# =============================================================================
# File: GoBall source lv_conf.h  [CODE]

LVGL_MEM_SIZE_MB = 512              # LVGL heap size (MB)
LVGL_DPI = 130                      # Display DPI for UI scaling
LVGL_DRAW_THREADS = 4               # Software render thread count
LVGL_CACHE_SIZE_MB = 8              # Image cache (MB)
LVGL_REFRESH_MS = 16                # Display refresh period (~60fps)

# =============================================================================
# QUICK DEPLOYMENT CHECKLIST
# =============================================================================
# When deploying to a new machine:
#
# 1. [ ] Set WIFI_SSID and WIFI_PASSWORD for the venue
# 2. [ ] Set ETH_STATIC_IP if different subnet needed
# 3. [ ] Verify HDMI_OUTPUT matches the physical port used
# 4. [ ] Set DISPLAY_WIDTH x DISPLAY_HEIGHT for the target monitor
# 5. [ ] Update hal_init() in main.c to match display resolution
# 6. [ ] Update weston.ini mode= to match display resolution
# 7. [ ] Update local.conf hdmi_cvt and video= to match display resolution
# 8. [ ] Verify GPIO pins match physical sensor wiring
# 9. [ ] Set LED_ENABLED=true and LED_PIXELS if LED strips are connected
# 10.[ ] Replace SSH authorized_keys with deployment keys
# 11.[ ] Set CMAKE_BUILD_TYPE=Release for production
# 12.[ ] Run: bitbake goball -c cleansstate && bitbake goball-image
# 13.[ ] Flash SD card and configure EEPROM (DISPLAY_DIAGNOSTIC=0)
